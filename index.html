// HTML'de modal içindeki activityMap div'inden sonra ekleyin
`<div id="elevationProfile" class="h-40 bg-white rounded-lg mt-4 p-2">
    <canvas id="elevationCanvas"></canvas>
</div>`

// JavaScript koduna ekleyin:
function drawElevationProfile(points, mapDiv) {
    const canvas = document.getElementById('elevationCanvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('elevationProfile');
    
    // Canvas boyutlarını ayarla
    canvas.width = container.offsetWidth - 20; // padding için -20
    canvas.height = container.offsetHeight - 20;
    
    // Yükseklik değerlerini al
    const elevations = points.map(p => p.altitude || 0);
    const minElevation = Math.min(...elevations);
    const maxElevation = Math.max(...elevations);
    const elevationRange = maxElevation - minElevation;
    
    // Çizim alanı marjinleri
    const margin = { top: 20, right: 30, bottom: 30, left: 40 };
    const width = canvas.width - margin.left - margin.right;
    const height = canvas.height - margin.top - margin.bottom;
    
    // Ölçeklendirme fonksiyonları
    const scaleX = width / (points.length - 1);
    const scaleY = height / elevationRange;
    
    // Izgara çiz
    ctx.beginPath();
    ctx.strokeStyle = '#e5e5e5';
    ctx.lineWidth = 0.5;
    
    // Yatay ızgara çizgileri
    for (let i = 0; i <= 5; i++) {
        const y = margin.top + (height * i / 5);
        ctx.moveTo(margin.left, y);
        ctx.lineTo(width + margin.left, y);
        
        // Yükseklik etiketleri
        const elevation = Math.round(maxElevation - (elevationRange * i / 5));
        ctx.fillStyle = '#666';
        ctx.font = '10px Arial';
        ctx.fillText(`${elevation}m`, 5, y + 4);
    }
    ctx.stroke();
    
    // Profil çizgisi
    ctx.beginPath();
    ctx.strokeStyle = '#3b82f6';
    ctx.lineWidth = 2;
    
    points.forEach((point, i) => {
        const x = margin.left + (i * scaleX);
        const y = margin.top + height - ((point.altitude - minElevation) * scaleY);
        
        if (i === 0) {
            ctx.moveTo(x, y);
        } else {
            ctx.lineTo(x, y);
        }
    });
    ctx.stroke();
    
    // İnteraktif overlay için mouse takibi
    let mapMarker = null;
    
    canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left - margin.left;
        const index = Math.round(mouseX / scaleX);
        
        if (index >= 0 && index < points.length) {
            // Önceki çizimi temizle
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Profili tekrar çiz
            drawBaseProfile();
            
            // Dikey çizgi çiz
            ctx.beginPath();
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            const lineX = margin.left + (index * scaleX);
            ctx.moveTo(lineX, margin.top);
            ctx.lineTo(lineX, height + margin.top);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Noktanın değerlerini göster
            const point = points[index];
            const tooltipY = margin.top + height - ((point.altitude - minElevation) * scaleY);
            
            ctx.fillStyle = 'rgba(0,0,0,0.8)';
            ctx.beginPath();
            ctx.arc(lineX, tooltipY, 4, 0, Math.PI * 2);
            ctx.fill();
            
            // Tooltip
            const tooltipText = `Yükseklik: ${Math.round(point.altitude)}m${point.cadence ? `, Kadans: ${Math.round(point.cadence)}` : ''}`;
            ctx.fillStyle = 'rgba(0,0,0,0.8)';
            ctx.fillRect(lineX + 5, tooltipY - 20, ctx.measureText(tooltipText).width + 10, 20);
            ctx.fillStyle = '#fff';
            ctx.fillText(tooltipText, lineX + 10, tooltipY - 5);
            
            // Harita üzerinde marker'ı güncelle
            if (mapMarker) {
                currentMap.removeLayer(mapMarker);
            }
            mapMarker = L.circleMarker(point.latlng, {
                radius: 8,
                color: '#3b82f6',
                fillColor: '#3b82f6',
                fillOpacity: 1
            }).addTo(currentMap);
        }
    });
    
    canvas.addEventListener('mouseout', () => {
        // Mouse çıkınca marker'ı kaldır
        if (mapMarker) {
            currentMap.removeLayer(mapMarker);
            mapMarker = null;
        }
        
        // Profili tekrar çiz
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawBaseProfile();
    });
    
    // Temel profili çizme fonksiyonu
    function drawBaseProfile() {
        // Izgara
        ctx.beginPath();
        ctx.strokeStyle = '#e5e5e5';
        ctx.lineWidth = 0.5;
        for (let i = 0; i <= 5; i++) {
            const y = margin.top + (height * i / 5);
            ctx.moveTo(margin.left, y);
            ctx.lineTo(width + margin.left, y);
            
            const elevation = Math.round(maxElevation - (elevationRange * i / 5));
            ctx.fillStyle = '#666';
            ctx.font = '10px Arial';
            ctx.fillText(`${elevation}m`, 5, y + 4);
        }
        ctx.stroke();
        
        // Profil çizgisi
        ctx.beginPath();
        ctx.strokeStyle = '#3b82f6';
        ctx.lineWidth = 2;
        points.forEach((point, i) => {
            const x = margin.left + (i * scaleX);
            const y = margin.top + height - ((point.altitude - minElevation) * scaleY);
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        });
        ctx.stroke();
    }
}

// initializeEnhancedMap fonksiyonunu güncelleyin
function initializeEnhancedMap(container, streams) {
    // ... (mevcut harita kodu) ...
    
    // Harita ayarlandıktan sonra yükselti profilini çiz
    drawElevationProfile(points, container);
}
